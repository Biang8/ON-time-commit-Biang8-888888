name: wxread

on:
  schedule:
    - cron: '0 21 * * *'  # 北京5:00左右开始
    - cron: '40 3 * * *'  # 北京11:40左右开始
    - cron: '00 14 * * *' # 北京21:30 - 22:00左右开始
    - cron: '0 9 * * sat' # 周六随机阅读
    - cron: '0 9 * * sun' # 周日随机阅读
  workflow_dispatch:
    inputs:
      mode:
        description: '运行模式 (auto/manual)'
        required: false
        default: 'auto'

env:
  DNS_SERVER_1: 8.8.8.8
  DNS_SERVER_2: 8.8.4.4
  PYTHON_VERSION: '3.10'  # 定义环境变量
  CERTIFI_VERSION: 2024.8.30
  CHARSET_NORMALIZER_VERSION: 3.4.0
  IDNA_VERSION: 3.10
  REQUESTS_VERSION: 2.32.3
  URLLIB3_VERSION: 2.2.3
  BASE_MINUTES: $((3 * 60 + 30))
  FLOAT_MINUTES: 30
  WEEKEND_MIN: 90
  WEEKEND_MAX: 190

jobs:
  deploy:
    runs-on: ubuntu-22.04
    environment: AutoRead

    steps:
    - name: 🔧 设置DNS
      run: |
        echo "nameserver $DNS_SERVER_1" | sudo tee /etc/resolv.conf
        echo "nameserver $DNS_SERVER_2" | sudo tee -a /etc/resolv.conf
        echo "✅ DNS配置完成"

    - name: 📥 检出仓库
      uses: actions/checkout@v4

    - name: 缓存依赖
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: 🐍 设置Python $PYTHON_VERSION
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}  # 修正引用方式
